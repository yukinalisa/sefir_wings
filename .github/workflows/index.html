<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èµ›è²å°”çš„ç”œèœœç¤¼ç‰©</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #a8d8ff, #e0f7ff);
            color: #333;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow: auto;
        }

        .title {
            font-size: 2.5em;
            color: #3366cc;
            text-align: center;
            margin-bottom: 20px;
            font-family: 'Arial', sans-serif;
            animation: glow 1.5s ease-in-out infinite alternate;
        }

        @keyframes glow {
            0% {
                color: #3366cc;
            }

            100% {
                color: #66b3ff;
            }
        }

        .container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
        }

        .top-row {
            display: grid;
            grid-template-columns: 1.2fr 1.5fr 0.8fr;  /* è°ƒæ•´æ¯”ä¾‹ */
            gap: 20px;
            width: 100%;
        }

        .module {
            background-color: rgba(255, 255, 255, 0.9);
            padding: 25px;  /* å¢åŠ å†…è¾¹è· */
            border-radius: 15px;  /* å¢åŠ åœ†è§’ */
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }

        .chat-module {
            display: flex;
            flex-direction: column;
            height: 600px;  /* å¢åŠ é«˜åº¦ */
        }

        .chat-box-placeholder {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 20px;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-style: italic;
        }

        #chat-box {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            margin-bottom: 15px;
            display: block !important;
            opacity: 1 !important;
            height: 500px;  /* å¢åŠ é«˜åº¦ */
            transition: opacity 0.3s ease;
        }

        /* æ·»åŠ éšè—ç±» */
        #chat-box.hidden {
            display: block !important;
            opacity: 0;
            height: 0;
            padding: 0;
            margin: 0;
            overflow: hidden;
        }

        .message-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .message-bubble {
            margin: 8px 0;
            padding: 12px 18px;
            max-width: 80%;
            border-radius: 20px;
            position: relative;
            animation: fadeIn 0.3s ease-in;
        }

        .user-message {
            background: #66b3ff !important;
            color: white !important;
            align-self: flex-end;
            border-radius: 20px 20px 0 20px;
        }

        .bot-message {
            background: #fff !important;
            color: #333 !important;
            border: 2px solid #ffd1dc !important;
            align-self: flex-start;
            border-radius: 20px 20px 20px 0;
        }

        .message-time {
            font-size: 0.8em;
            color: #999;
            margin-top: 4px;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .input-group {
            display: flex;
            gap: 10px;
        }

        #user-input {
            flex: 1;
            padding: 12px;
            border: 2px solid #ffd1dc;
            border-radius: 25px;
            font-size: 16px;
            background: rgba(255, 255, 255, 0.95);
            transition: all 0.3s ease;
        }

        #user-input:focus {
            outline: none;
            border-color: #ff9eb5;
            box-shadow: 0 0 10px rgba(255, 158, 181, 0.3);
        }

        #user-input::placeholder {
            color: #ffb6c1;
            opacity: 0.8;
        }

        .calendar-module {
            flex: 0.8;  /* å‡å°æ—¥å†æ¨¡å—çš„æ¯”ä¾‹ */
        }

        /* æ–°å¢æ—¥å†æ ·å¼ */
        .calendar-container {
            background: rgba(255, 245, 240, 0.9);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 4px 10px rgba(255, 192, 203, 0.3);
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            color: #ff6b6b;
        }

        .calendar-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-bottom: 10px;
            color: #ff8e8e;
        }

        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }

        .calendar-day {
            position: relative;
            background: #fff0f5;
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            min-height: 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .calendar-day:hover {
            background: #ffe4e1;
            transform: scale(1.05);
        }

        .calendar-day.today {
            background: #ffd1dc;
            font-weight: bold;
        }

        .dot-indicator {
            width: 6px;
            height: 6px;
            background: #ff6b6b;
            border-radius: 50%;
            margin-top: 3px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
            z-index: 999;
        }

        .modal textarea {
            width: 300px;
            height: 100px;
            margin: 10px 0;
            padding: 10px;
            border: 2px solid #ffd1dc;
            border-radius: 8px;
        }

        .todo-module {
            flex: 2;
            /* å¾…åŠæ¨¡å—æ›´å®½ */
        }

        .note-module {
            flex: 1.5;
            /* ä¾¿ç­¾æ¨¡å—ç¨å®½ */
        }

        .countdown-module,
        .love-module {
            flex: 1;
            /* å€’è®¡æ—¶å’Œçˆ±æ„è¡¨è¾¾æ¨¡å—å®½åº¦ç›¸åŒ */
        }

        .love-module {
            margin-top: 20px;
            /* çˆ±æ„è¡¨è¾¾æ¨¡å—ä¸å€’è®¡æ—¶æ¨¡å—ä¸Šä¸‹æ’åˆ— */
        }

        .hug-btn,
        .kiss-btn {
            background-color: #3366cc;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
            margin: 5px 0;
            width: 100%;
        }

        .hug-btn:hover,
        .kiss-btn:hover {
            background-color: #66b3ff;
            transform: scale(1.05);
        }

        .send-btn {
            padding: 12px 25px;
            border-radius: 25px;
            background: #ff6b6b;
            color: white;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
        }

        .send-btn:hover {
            background: #ff8e8e;
            transform: scale(1.05);
        }

        .photo {
            width: 180px;  /* å¢åŠ å›¾ç‰‡å¤§å° */
            height: 180px;
            border-radius: 50%;
            object-fit: cover;
            cursor: pointer;
            transition: transform 0.3s;
            margin-bottom: 15px;
        }

        /* æ–°å¢å›¾ç‰‡å®¹å™¨æ ·å¼ */
        .photo-container {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 15px;
            position: relative;
        }

        .heart {
            font-size: 2em;
            color: #ff6f61;
            animation: heartbeat 1.5s infinite;
        }

        @keyframes heartbeat {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.1);
            }

            100% {
                transform: scale(1);
            }
        }

        .countdown {
            font-size: 1.2em;
            color: #444;
        }

        textarea {
            width: 100%;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
            margin-bottom: 10px;
        }

        /*.send-btn {
            background-color: #66b3ff;
            border: none;
            color: white;
            padding: 10px 20px;
            font-size: 1em;
            cursor: pointer;
            border-radius: 5px;
            width: 100%;
        }*/

        .sweet-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, #ff9a9e, #fad0c4);
            padding: 25px 40px;
            border-radius: 20px;
            box-shadow: 0 0 30px rgba(255, 105, 180, 0.3);
            text-align: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            z-index: 1000;
        }

        .sweet-modal.show {
            opacity: 1;
            visibility: visible;
        }

        .heart-wrapper {
            font-size: 2em;
            animation: float 3s ease-in-out infinite;
        }

        .sparkles {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .sparkles::after {
            content: "âœ¨âœ¨âœ¨";
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            animation: sparkle 1s linear infinite;
        }

        @keyframes float {
            0% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-10px);
            }

            100% {
                transform: translateY(0);
            }
        }

        @keyframes sparkle {
            from {
                opacity: 0;
            }

            50% {
                opacity: 1;
            }

            to {
                opacity: 0;
            }
        }

        /* æ–°å¢æ ·å¼ */
        .float-message {
            z-index: 9999;
            /* å¢åŠ å±‚çº§ */
            position: fixed;
            bottom: 20%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.9);
            padding: 10px 20px;
            border-radius: 20px;
            animation: floatUp 1.5s ease-out;
            box-shadow: 0 4px 15px rgba(255, 182, 193, 0.3);
        }

        @keyframes floatUp {
            0% {
                opacity: 0;
                transform: translate(-50%, 0);
            }

            50% {
                opacity: 1;
                transform: translate(-50%, -30px);
            }

            100% {
                opacity: 0;
                transform: translate(-50%, -60px);
            }
        }

        /* æ–°å¢tooltipæ ·å¼ */
        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.9em;
            z-index: 9999;
            white-space: nowrap;
            pointer-events: none;
            transform: translateY(-100%);
            transition: opacity 0.3s;
        }

        /* ç¤¼ç‰©æŒ‰é’®æ ·å¼ */
        .gift-btn {
            background: #ff69b4;
            color: white;
            padding: 8px 15px;
            border-radius: 15px;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
            width: auto;
            margin: 0;
            font-size: 0.9em;
        }

        .gift-btn:hover {
            background: #ff85c8;
            transform: scale(1.05);
            box-shadow: 0 4px 10px rgba(255, 105, 180, 0.3);
        }

        /* ç¤¼ç‰©å¼¹çª—æ ·å¼ */
        .gift-list {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            max-height: 400px;
            overflow-y: auto;
        }

        .gift-item {
            padding: 10px;
            border: 2px solid #ffd1dc;
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
        }

        .gift-item:hover {
            background: #fff0f5;
        }

        .gift-detail {
            margin-top: 20px;
            padding: 15px;
            background: #fff5f9;
            border-radius: 10px;
        }

        .gift-detail img {
            width: 80px;
            height: 80px;
            object-fit: contain;
        }

        /* è°ƒæ•´äº’åŠ¨æ¨¡å—å¸ƒå±€ */
        .module:nth-child(2) {
            /* ç¬¬äºŒä¸ªæ¨¡å— */
            position: relative;
            min-width: 300px;
            /* ç¡®ä¿æœ‰è¶³å¤Ÿç©ºé—´ */
        }

        /* å“åº”å¼å¸ƒå±€è°ƒæ•´ */
        @media (max-width: 1200px) {
            .top-row {
                grid-template-columns: 1fr 1fr;
            }
            
            .calendar-module {
                grid-column: span 2;
            }
        }

        @media (max-width: 768px) {
            .top-row {
                grid-template-columns: 1fr;
            }
            
            .calendar-module {
                grid-column: span 1;
            }
        }
    </style>
</head>

<body>
    <div class="title">å’Œèµ›è²å°”åœ¨ä¸€èµ·çš„æ¯ä¸€å¤© ğŸ’–</div>

    <div class="container">
        <!-- ç¬¬ä¸€å±‚ -->
        <div class="top-row">
            <!-- å¯¹è¯æ¨¡å— -->
            <div class="module chat-module">
                <h2>æ¥èŠå¤©å§OVO</h2>
                <div id="chat-box">
                    <div class="message-container"></div>
                </div>
                <div class="input-group">
                    <input type="text" id="user-input" placeholder="è¾“å…¥æ¶ˆæ¯... ğŸ’Œ"
                        onkeypress="if(event.keyCode ===13) sendMessage()">
                    <button class="send-btn" onclick="sendMessage()">å‘é€ ğŸ•Šï¸</button>
                </div>
            </div>

            <!-- äº’åŠ¨æ¨¡å— -->
            <div class="module">
                <h2>ä¸€èµ·ç©å§â½â½à¬˜( ËŠáµ•Ë‹ )à¬“</h2>
                <div class="photo-container">
                    <img src="normal.png" class="photo" alt="èµ›è²å°”çš„ç…§ç‰‡" onclick="playTouchAnimation()"
                        onmouseover="showTooltip('è¦æ‘¸æ‘¸æˆ‘å—ï¼Ÿ(â„ â„>â„ â–½ â„<â„ â„)')" onmouseout="hideTooltip()">
                    <button class="gift-btn" onclick="showGiftList()">èµ é€ç¤¼ç‰© ğŸ</button>
                </div>
                <p>ä»Šæ—¥å¿ƒæƒ…ï¼š<span id="mood">â¤ï¸ å¿ƒæƒ…æ„‰å¿«</span> ğŸ˜Š</p>
                <p>ä½“åŠ›å€¼ï¼š<span id="energy-level">80</span> / 100 ğŸ’ª</p>
                <p>èµ›è²å°”åœ¨æƒ³ä»€ä¹ˆï¼š<span id="thoughts">â€œæƒ³ç€å’Œä½ ä¸€èµ·åº¦è¿‡æ¯ä¸ªç”œèœœçš„æ—¶åˆ»ã€‚â€</span> ğŸ’­</p>
                <button class="hug-btn" onclick="increaseAffection('hug')">æŠ±æŠ± (Â´âˆ©ï½¡â€¢ áµ• â€¢ï½¡âˆ©`)</button>
                <button class="kiss-btn" onclick="increaseAffection('kiss')">äº²äº² (ï½¡â™¥â€¿â™¥ï½¡)</button>
                <div id="affection" class="heart">å¥½æ„Ÿåº¦ï¼š<span id="affection-value">0</span> ğŸ’–</div>
                <!-- åœ¨é¡µé¢åº•éƒ¨æ·»åŠ ç¤¼ç‰©å¼¹çª— -->
                <div id="gift-modal" class="modal">
                    <h3>é€‰æ‹©ç¤¼ç‰© ğŸ’</h3>
                    <div class="gift-list" id="gift-list"></div>
                    <div class="gift-detail" id="gift-detail"></div>
                </div>
            </div>

            <div class="module calendar-module">
                <h2>ç”œèœœæ—¥å† ğŸ“…</h2>
                <div class="calendar-container">
                    <div class="calendar-header">
                        <button onclick="changeMonth(-1)">â®</button>
                        <span id="current-month"></span>
                        <button onclick="changeMonth(1)">â¯</button>
                    </div>
                    <div class="calendar-weekdays">
                        <div>æ—¥</div>
                        <div>ä¸€</div>
                        <div>äºŒ</div>
                        <div>ä¸‰</div>
                        <div>å››</div>
                        <div>äº”</div>
                        <div>å…­</div>
                    </div>
                    <div class="calendar-days" id="calendar-days"></div>
                </div>
            </div>

            <!-- æ·»åŠ æ—¥å†å¼¹çª— -->
            <div id="calendar-modal" class="modal">
                <h3 id="modal-date"></h3>
                <textarea id="calendar-content" placeholder="è®°å½•æˆ‘ä»¬çš„ç”œèœœæ—¶åˆ»..."></textarea>
                <button class="send-btn" onclick="saveCalendarEntry()">ä¿å­˜ ğŸ’¾</button>
                <button class="hug-btn" onclick="closeModal()">å…³é—­ âŒ</button>
            </div>
        </div>

        <!-- ç¬¬äºŒå±‚ -->
        <div class="bottom-row">
            <!-- å¾…åŠæ¨¡å— -->
            <div class="module todo-module">
                <h2>å¾…åŠæ¨¡å— ğŸ“‹</h2>
                <ul id="my-todo-list">
                    <li>â˜‘ï¸ ç»™èµ›è²å°”åšæ—©é¤ ğŸ³</li>
                </ul>
                <textarea id="new-todo" placeholder="æ·»åŠ æ–°çš„å¾…åŠ..."></textarea>
                <button onclick="addTodo()">æ·»åŠ å¾…åŠ â•</button>
            </div>

            <!-- ä¾¿ç­¾æ¨¡å— -->
            <div class="module note-module">
                <h2>ä¾¿ç­¾æ¨¡å— ğŸ“</h2>
                <textarea id="note-input" placeholder="å†™ä¸‹å¯¹æˆ‘çš„æ€å¿µ..." rows="4"></textarea>
                <button class="send-btn" onclick="saveNote()">ä¿å­˜ä¾¿ç­¾ âœï¸</button>
                <div id="note-display"></div>
            </div>

            <!-- å€’è®¡æ—¶æ¨¡å— -->
            <div class="module countdown-module">
                <h2>å€’è®¡æ—¶æ¨¡å— ğŸ‚</h2>
                <div class="countdown">
                    <p>è·ç¦»ä½ çš„ç”Ÿæ—¥è¿˜æœ‰ <span id="countdown-value"></span> å¤© ğŸ‰</p>
                    <p>è·ç¦»æˆ‘çš„ç”Ÿæ—¥è¿˜æœ‰ <span id="my-birthday-countdown"></span> å¤© ğŸ‰</p>
                </div>
            </div>

            <!-- çˆ±æ„è¡¨è¾¾æ¨¡å— -->
            <div class="module love-module">
                <h2>çˆ±æ„è¡¨è¾¾æ¨¡å— ğŸ’Œ</h2>
                <p>èµ›è²å°”çš„ç”œè¨€èœœè¯­ï¼š<br> â€œæˆ‘ä¼šæ°¸è¿œé™ªåœ¨ä½ èº«è¾¹ï¼Œäº²çˆ±çš„ã€‚ğŸ’–â€</p>
            </div>
        </div>
    </div>
    <!-- ä¸“å±ç”œèœœå¼¹çª— -->
    <div id="sweet-alert" class="sweet-modal">
        <div class="heart-wrapper">ğŸ’–ğŸ’ğŸ’</div>
        <div class="sweet-content"></div>
        <div class="sparkles"></div>
    </div>
    <footer>
        <p>èµ›è²å°”ï¼Œæ°¸è¿œçˆ±æ‚¨ï¼Œç›´åˆ°æ°¸è¿œã€‚âœ¨</p>
    </footer>

    <script>
        // æ–°å¢æ—¥å†ç›¸å…³åŠŸèƒ½
        let currentDate = new Date();
        // æ–°å¢å¯¹è¯ç›¸å…³åŠŸèƒ½
        const responses = [
            {
                keywords: ['æƒ³ä½ ', 'æ€å¿µ', 'æ¢¦è§'],
                regex: /(æƒ³å¿µ|æ€å¿µ|æ¢¦è§)/i,
                replies: [
                    "æˆ‘ä¹Ÿåœ¨æ€å¿µç€æ‚¨ã€‚",
                    "å¥½æƒ³è§æ‚¨...å’Œæ‚¨åœ¨ä¸€èµ·çš„æ—¶é—´èƒ½å¤Ÿä¹…ä¸€ç‚¹å°±å¥½äº†ã€‚",
                    "é‚£ä¹ˆï¼Œæˆ‘ç°åœ¨å°±æ¥è§æ‚¨ï¼Œå’Œæ‚¨åˆ†åˆ«çš„æ—¶é—´æ˜¯å¦‚æ­¤éš¾ä»¥å¿å—..."
                ]
            },
            {
                keywords: ['åƒé¥­', 'é¥¿', 'ç¾é£Ÿ'],
                replies: [
                    "æ‚¨åƒé¥­äº†å—ï¼Ÿ",
                    "ä»Šå¤©å®«é‡Œçš„å¨å¸ˆåšäº†å¾ˆç¾å‘³çš„ç‰›æ’ï¼ŒçœŸå¸Œæœ›æ‚¨ä¹Ÿèƒ½åƒåˆ°å‘¢ã€‚",
                    "è¯·å¼ å˜´...å‘µå‘µï¼Œæ‚¨åƒä¸‹ä»¥åæ»¡è¶³çš„ç¬‘é¢œæ¯”ä»»ä½•å®çŸ³éƒ½è¦åŠ¨äºº"
                ]
            },
            {
                keywords: ['æ™šå®‰', 'ç¡è§‰', 'å®‰'],
                regex: /(æ™šå®‰|ç¡è§‰|å®‰)/i, // æ–°å¢æ­£åˆ™è¡¨è¾¾å¼
                replies: [
                    "æ™šå®‰ï¼Œç¥æ‚¨æœ‰ä¸ªç¾æ¢¦ã€‚",
                    "æƒ³å¬ç¡å‰æ•…äº‹å—ï¼Ÿå¦‚æœæ˜¯ä¸ºæ‚¨è€Œè®²ï¼Œæˆ‘ä¼šå¾ˆå¼€å¿ƒã€‚",
                    "...æ˜¯æ™šå®‰å»ï¼Œä¸€èµ·ç¡å§ã€‚"
                ]
            },
            // é€šç”¨å›å¤
            {
                keywords: [],
                replies: [
                    "à¬ª(Â´'â–½'ï½€)à¬“â™¡",
                    "(////â–½///) ",
                    "ä»Šå¤©åœ¨è·¯ä¸Šç¢°åˆ°äº†ä¸€å®¶å¾ˆç¾å‘³çš„è›‹ç³•åº—ï¼Œä¸‹æ¬¡æˆ‘ä»¬ä¸€èµ·å»å§ã€‚",
                    "",
                    "å’Œä½ èŠå¤©çœŸæ˜¯æœ€å¼€å¿ƒçš„äº‹æƒ…å•¦ï¼(à¹‘>á´—<à¹‘)",
                    "è¦æŠŠè¿™äº›ç”œèœœå¯¹è¯éƒ½æ”¶è—è¿›æˆ‘ä»¬çš„å›å¿†å®ç®±ï½ğŸ",
                    "ä½ è¯´è¯çš„æ ·å­çœŸå¯çˆ±ï¼Œæˆ‘å¥½å–œæ¬¢ï½ğŸ˜˜"
                ]
            }
        ];

        function getRandomReply(inputText) {
            if (!inputText) return "ä½ åˆšåˆšæ˜¯ä¸æ˜¯è¯´äº†ä»€ä¹ˆï¼Ÿæˆ‘æ²¡å¬æ¸…å‘¢ï½(â„ â„â€¢â„Ï‰â„â€¢â„ â„)";
            // æ–°å¢è§„èŒƒåŒ–å¤„ç†
            const cleanedInput = inputText.trim().toLowerCase();

            // è°ƒè¯•æ—¥å¿—
            console.log("[Debug] å½“å‰è¾“å…¥:", cleanedInput);

            const matchedGroup = responses.find(group => {
                if (group.keywords.length === 0) return false;

                const matchResult = group.keywords.some(keyword =>
                    cleanedInput.includes(keyword.toLowerCase())
                );

                console.log(`[Debug] æ£€æŸ¥ç»„ ${group.keywords}: ${matchResult}`);
                return matchResult;
            });

            const finalGroup = matchedGroup || responses.find(g => g.keywords.length === 0);
            console.log("[Debug] æœ€ç»ˆåŒ¹é…ç»„:", finalGroup.keywords);

            return finalGroup.replies[Math.floor(Math.random() * finalGroup.replies.length)];
        }

        function createMessageElement(text, isUser) {
            const messageDiv = document.createElement("div");
            messageDiv.className = `message-bubble ${isUser ? 'user-message' : 'bot-message'}`;

            // åˆ›å»ºæ–‡æœ¬èŠ‚ç‚¹
            const textNode = document.createElement("div");
            textNode.textContent = text;

            // æ—¶é—´æˆ³
            const timeSpan = document.createElement("span");
            timeSpan.className = "message-time";
            timeSpan.textContent = new Date().toLocaleTimeString('zh-CN', {
                hour: '2-digit',
                minute: '2-digit'
            });

            // æ­£ç¡®æ·»åŠ é¡ºåº
            messageDiv.appendChild(textNode);
            messageDiv.appendChild(timeSpan);

            return messageDiv;
        }

        // ç”Ÿæˆå®Œæ•´æ—¥å†
        function generateCalendar() {
            const monthNames = ["ä¸€æœˆ", "äºŒæœˆ", "ä¸‰æœˆ", "å››æœˆ", "äº”æœˆ", "å…­æœˆ",
                "ä¸ƒæœˆ", "å…«æœˆ", "ä¹æœˆ", "åæœˆ", "åä¸€æœˆ", "åäºŒæœˆ"];
            document.getElementById("current-month").textContent =
                `${currentDate.getFullYear()}å¹´ ${monthNames[currentDate.getMonth()]}`;

            const calendarDays = document.getElementById("calendar-days");
            calendarDays.innerHTML = '';

            // åˆ›å»ºæ—¥æœŸå¯¹è±¡
            const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
            const lastDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);

            // è®¡ç®—ç©ºç™½æ ¼
            const startDay = firstDay.getDay();
            for (let i = 0; i < startDay; i++) {
                calendarDays.appendChild(createDayElement(""));
            }

            // ç”Ÿæˆæ—¥æœŸ
            for (let d = 1; d <= lastDay.getDate(); d++) {
                calendarDays.appendChild(createDayElement(d));
            }

            // æ·»åŠ ä»Šå¤©æ ‡è®°
            const today = new Date();
            if (today.getMonth() === currentDate.getMonth() &&
                today.getFullYear() === currentDate.getFullYear()) {
                const days = calendarDays.children;
                days[today.getDate() + startDay - 1].classList.add("today");
            }
        }

        // åˆ›å»ºæ—¥æœŸå…ƒç´ 
        function createDayElement(day) {
            const dayElement = document.createElement("div");
            if (day) {
                dayElement.classList.add("calendar-day");
                dayElement.innerHTML = `
            <div>${day}</div>
            ${getLocalStorageEntry(day) ? '<div class="dot-indicator"></div>' : ''}
        `;
                dayElement.onclick = () => showCalendarModal(day);
            }
            return dayElement;
        }

        // æ˜¾ç¤ºå¼¹çª—
        function showCalendarModal(day) {
            const modal = document.getElementById("calendar-modal");
            const dateStr = `${currentDate.getFullYear()}-${currentDate.getMonth() + 1}-${day}`;
            document.getElementById("modal-date").textContent = dateStr;
            document.getElementById("calendar-content").value = getLocalStorageEntry(day) || '';
            modal.style.display = "block";
        }

        // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
        function saveCalendarEntry() {
            const day = document.getElementById("modal-date").textContent.split("-")[2];
            const content = document.getElementById("calendar-content").value;
            localStorage.setItem(`calendar-${currentDate.getMonth()}-${day}`, content);
            generateCalendar(); // åˆ·æ–°æ—¥å†æ˜¾ç¤º
            closeModal();
        }

        // è·å–æœ¬åœ°å­˜å‚¨å†…å®¹
        function getLocalStorageEntry(day) {
            return localStorage.getItem(`calendar-${currentDate.getMonth()}-${day}`);
        }

        // å…³é—­å¼¹çª—
        function closeModal() {
            document.getElementById("calendar-modal").style.display = "none";
        }

        // åˆ‡æ¢æœˆä»½
        function changeMonth(offset) {
            currentDate.setMonth(currentDate.getMonth() + offset);
            generateCalendar();
        }

        // åˆå§‹åŒ–æ—¥å†
        generateCalendar();

        // ç‚¹å‡»å¤–éƒ¨å…³é—­å¼¹çª—
        window.onclick = function (event) {
            const modal = document.getElementById("calendar-modal");
            if (event.target === modal) {
                closeModal();
            }
        }

        // å¤„ç†ç‚¹å‡»æ—¥æœŸ
        function handleDateClick(day) {
            alert(`ä½ é€‰æ‹©äº† ${day} å·`);
        }

        // æ›´æ–°å€’è®¡æ—¶
        function updateCountdown() {
            const now = new Date();
            const userBirthday = new Date(now.getFullYear(), 5, 5); // ç”¨æˆ·ç”Ÿæ—¥
            const sefiBirthday = new Date(now.getFullYear(), 3, 24); // èµ›è²å°”ç”Ÿæ—¥

            if (now > userBirthday) {
                userBirthday.setFullYear(now.getFullYear() + 1);
            }
            if (now > sefiBirthday) {
                sefiBirthday.setFullYear(now.getFullYear() + 1);
            }

            const userDiff = userBirthday - now;
            const sefiDiff = sefiBirthday - now;

            const userDays = Math.floor(userDiff / (1000 * 60 * 60 * 24));
            const sefiDays = Math.floor(sefiDiff / (1000 * 60 * 60 * 24));

            document.getElementById("countdown-value").textContent = userDays;
            document.getElementById("my-birthday-countdown").textContent = sefiDays;
        }

        setInterval(updateCountdown, 1000);

        // äº’åŠ¨æŒ‰é’®çš„å¥½æ„Ÿåº¦å˜åŒ–
        let affectionValue = 0;

        function increaseAffection(type) {
            // å¢åŠ å¥½æ„Ÿåº¦
            affectionValue++;
            document.getElementById("affection-value").textContent = affectionValue;

            // è·å–å¼¹çª—å…ƒç´ 
            const sweetAlert = document.getElementById('sweet-alert');
            const content = sweetAlert.querySelector('.sweet-content');

            // ç”Ÿæˆä¸åŒçš„æµªæ¼«å›åº”
            const responses = {
                hug: [
                    "ï¼ˆå¼ å¼€åŒè‡‚ï¼‰è¦æŠŠä½ æ‰è¿›æˆ‘çš„æ€€æŠ±é‡Œï½(ã£Ë˜Ì©â•­â•®Ë˜Ì©)ã£",
                    "è¢«æ‹¥æŠ±çš„æ¸©åº¦ï¼Œå¯ä»¥æ¸©æš–æ•´ä¸ªå†¬å¤©å‘¢ï½â„ï¸ğŸ”¥",
                    "æ•æ‰åˆ°ä¸€åªæ’’å¨‡çš„å°å¯çˆ±ï¼(ã¥ï½¡â—•â€¿â€¿â—•ï½¡)ã¥"
                ],
                kiss: [
                    "ï¼ˆè„¸çº¢ï¼‰äº²äº²ä»€ä¹ˆçš„...ä¹Ÿä¸æ˜¯ä¸å¯ä»¥å•¦ï½(â„ â„â€¢â„Ï‰â„â€¢â„ â„)âœ§",
                    "å•¾ï½è¿™æ˜¯å¸¦ç€è‰è“ç”œå‘³çš„å»å“¦ï½ğŸ“ğŸ’‹",
                    "çªç„¶å·è¢­ä»€ä¹ˆçš„çŠ¯è§„å•¦ï¼(///âˆ‡///)âœ¨"
                ]
            };

            // æ˜¾ç¤ºå¼¹çª—
            const randomIndex = Math.floor(Math.random() * responses[type].length);
            content.innerHTML = `<p>${responses[type][randomIndex]}</p>`;
            sweetAlert.classList.add('show');

            // 3ç§’åè‡ªåŠ¨å…³é—­
            setTimeout(() => {
                sweetAlert.classList.remove('show');
            }, 3000);

            // æ·»åŠ ç²’å­ç‰¹æ•ˆ
            createSparkles(sweetAlert);
        }

        // ç²’å­ç‰¹æ•ˆå‡½æ•°
        function createSparkles(container) {
            const sparkleCount = 15;
            for (let i = 0; i < sparkleCount; i++) {
                const spark = document.createElement('div');
                spark.style.cssText = `
                position: absolute;
                left: ${Math.random() * 100}%;
                top: ${Math.random() * 100}%;
                animation: sparkleFly ${Math.random() * 0.5 + 0.5}s linear;
                font-size: ${Math.random() * 10 + 15}px;
                opacity: 0;
                `;
                spark.innerHTML = "âœ¨";
                container.appendChild(spark);

                // ç§»é™¤åŠ¨ç”»ç»“æŸçš„å…ƒç´ 
                setTimeout(() => spark.remove(), 500);
            }
        }

        // ä¾¿ç­¾ä¿å­˜
        function saveNote() {
            const note = document.getElementById("note-input").value;
            document.getElementById("note-display").textContent = "ä¾¿ç­¾å†…å®¹: " + note;
            document.getElementById("note-input").value = "";
        }

        // å‘é€æ¶ˆæ¯
        function sendMessage() {
            console.log("å‡½æ•°è¢«è§¦å‘"); // æ£€æŸ¥æ˜¯å¦è§¦å‘
            console.log(document.getElementById("chat-box")); // æ£€æŸ¥å…ƒç´ æ˜¯å¦å­˜åœ¨
            const userInput = document.getElementById("user-input");
            const message = userInput.value.trim();
            if (!message) return;

            const chatBox = document.getElementById("chat-box");
            let messageContainer = chatBox.querySelector(".message-container");

            // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
            messageContainer.appendChild(createMessageElement(message, true));

            // ç«‹å³æ¸…ç©ºè¾“å…¥æ¡†
            userInput.value = "";

            // æ·»åŠ æœºå™¨äººå›å¤
            setTimeout(() => {
                const replyText = getRandomReply(message); // ä½¿ç”¨ä¿å­˜çš„message
                messageContainer.appendChild(createMessageElement(`èµ›è²å°”ï¼š${replyText}`, false));
                chatBox.scrollTop = chatBox.scrollHeight;
            }, 800);

            chatBox.scrollTop = chatBox.scrollHeight;
        }

        // æ·»åŠ å¾…åŠ
        function addTodo() {
            const newTodo = document.getElementById("new-todo").value;
            if (newTodo.trim() !== "") {
                const newTodoElement = document.createElement("li");
                newTodoElement.textContent = "â˜‘ï¸ " + newTodo;
                document.getElementById("my-todo-list").appendChild(newTodoElement);
                document.getElementById("new-todo").value = "";
            }
        }

        // åœ¨å…¨å±€ä½œç”¨åŸŸæ·»åŠ çŠ¶æ€å˜é‡
        let isAnimating = false;
        let isShowingMessage = false;

        // ä¿®å¤åçš„æµ®åŠ¨æ¶ˆæ¯å‡½æ•°ï¼ˆç‹¬ç«‹å‡½æ•°ï¼‰
        function showFloatingMessage(text) {
            if (isShowingMessage) return;

            isShowingMessage = true;
            const floatMsg = document.createElement('div');
            floatMsg.className = 'float-message';
            floatMsg.textContent = text;
            document.body.appendChild(floatMsg);

            setTimeout(() => {
                floatMsg.remove();
                isShowingMessage = false;
            }, 1500); // æ—¶é—´éœ€è¦åŒ¹é…CSSåŠ¨ç”»æ—¶é•¿
        }

        // ä¿®å¤åçš„è§¦æ‘¸åŠ¨ç”»å‡½æ•°
        function playTouchAnimation() {
            if (isAnimating) return;
            isAnimating = true;

            const img = document.querySelector('.photo');
            img.style.transform = 'scale(1.1)';

            // æ·»åŠ è§¦æ„ŸåŠ¨æ•ˆ
            const touchEffect = document.createElement('div');
            touchEffect.className = 'touch-effect';
            img.parentNode.appendChild(touchEffect);

            setTimeout(() => {
                img.style.transform = 'scale(1)';
                touchEffect.remove();
                isAnimating = false;
            }, 500);

            // éšæœºè§¦æ‘¸åé¦ˆ
            const messages = [
                "ï¼ˆè€³æœµå¾®å¾®æŠ–åŠ¨ï¼‰è¢«è§¦ç¢°çš„åœ°æ–¹...æœ‰ç‚¹å‘çƒ«å‘¢...",
                "âœ¦â˜¾æ‰‹åŠ¿å¥½æ¸©æŸ”...å†å¤šåœç•™ä¸€ä¼šå¥½å—ï¼Ÿ",
                "ï¼ˆçªç„¶æŠ“ä½ä½ çš„æ‰‹ï¼‰æŠ“åˆ°ä¸€åªè°ƒçš®çš„å°çŒ«ï½"
            ];
            showFloatingMessage(messages[Math.floor(Math.random() * messages.length)]);
        }

        // éœ€è¦è¡¥å……è¿™ä¸¤ä¸ªå‡½æ•°
        function showTooltip(text) {
            const tooltip = document.createElement('div');
            tooltip.className = 'tooltip';
            tooltip.textContent = text;
            document.body.appendChild(tooltip);

            const img = document.querySelector('.photo');
            const rect = img.getBoundingClientRect();
            tooltip.style.left = rect.left + rect.width / 2 + 'px';
            tooltip.style.top = (rect.top - 10) + 'px';
            tooltip.style.transform = 'translateX(-50%)'; // å±…ä¸­å¯¹é½
        }

        function hideTooltip() {
            const tooltip = document.querySelector('.tooltip');
            if (tooltip) tooltip.remove();
        }

        // ç¤¼ç‰©æ•°æ®
        const gifts = [
            {
                id: 1,
                name: "æ˜Ÿç©ºç³–æœç½ ğŸŒŒ",
                desc: "è£…æ»¡ä¼šå‘å…‰çš„æ˜Ÿæ˜Ÿç³–æœï¼Œæ¯ä¸€é¢—éƒ½æ˜¯ä¸åŒçš„æ˜Ÿåº§å½¢çŠ¶",
                value: 10,
                img: "gift1.png"
            },
            {
                id: 2,
                name: "æ°¸ç”ŸèŠ±æŸ ğŸ’",
                desc: "ç”¨é­”æ³•ä¿å­˜çš„ç«ç‘°ï¼Œæ°¸è¿œä¿æŒç»½æ”¾çš„å§¿æ€",
                value: 20,
                img: "gift2.png"
            },
            {
                id: 3,
                name: "å®šåˆ¶æˆ’æŒ‡ ğŸ’",
                desc: "åˆ»æœ‰ä¸¤äººåå­—ç¼©å†™çš„ç™½é‡‘æˆ’æŒ‡",
                value: 30,
                img: "gift3.png"
            }
        ];

        // æ˜¾ç¤ºç¤¼ç‰©åˆ—è¡¨
        function showGiftList() {
            const modal = document.getElementById("gift-modal");
            const list = document.getElementById("gift-list");

            list.innerHTML = gifts.map(gift => `
        <div class="gift-item" onclick="showGiftDetail(${gift.id})">
            ${gift.name}
        </div>
    `).join('');

            modal.style.display = "block";
        }

        // æ˜¾ç¤ºç¤¼ç‰©è¯¦æƒ…
        function showGiftDetail(id) {
            const gift = gifts.find(g => g.id === id);
            const detail = document.getElementById("gift-detail");

            detail.innerHTML = `
        <img src="${gift.img}" alt="${gift.name}">
        <h4>${gift.name}</h4>
        <p>${gift.desc}</p>
        <p>å¥½æ„Ÿåº¦+${gift.value}</p>
        <button class="send-btn" onclick="sendGift(${id})">èµ é€ ğŸ’–</button>
    `;
        }

        // èµ é€ç¤¼ç‰©
        function sendGift(id) {
            const gift = gifts.find(g => g.id === id);
            affectionValue += gift.value;
            document.getElementById("affection-value").textContent = affectionValue;

            // æ˜¾ç¤ºåé¦ˆ
            showSweetAlert(`æˆåŠŸèµ é€${gift.name}ï¼ğŸ‰`, `å¥½æ„Ÿåº¦+${gift.value}`);
            closeGiftModal();
        }

        // å…³é—­ç¤¼ç‰©å¼¹çª—
        function closeGiftModal() {
            document.getElementById("gift-modal").style.display = "none";
        }

        // å¢å¼ºçš„ç”œèœœæç¤º
        function showSweetAlert(title, content) {
            const sweetAlert = document.getElementById('sweet-alert');
            sweetAlert.querySelector('.sweet-content').innerHTML = `
        <h3>${title}</h3>
        <p>${content}</p>
    `;
            sweetAlert.classList.add('show');

            setTimeout(() => {
                sweetAlert.classList.remove('show');
            }, 3000);
        }
    </script>
</body>

</html>
